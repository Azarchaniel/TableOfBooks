Attribute VB_Name = "aktualizuj"
Sub zorad_nazov_autor()
'
' Update - creating histogram, graphs and sorting by name and author
'
    Dim table As String
    Dim ws As String
    
    StartTime = Now() 'for checking performance speed
    
    Call InitProgressBar
    If ActiveSheet.Name = "Knihy_L'uboš" Then
        Worksheets("Knihy_L'uboš").Activate
        ws = "Knihy_L'uboš"
        table = "Tabu1"
    End If
    If ActiveSheet.Name = "Knihy_Žanetka" Then
        Worksheets("Knihy_Žanetka").Activate
        ws = "Knihy_Žanetka"
        table = "Tabu2"
    End If
    If ActiveSheet.Name = "LP" Then
        Worksheets("LP").Activate
        table = "Tabu3"
    End If
    If ActiveSheet.Name = "Èasopisy" Then
        Worksheets("Èasopisy").Activate
        table = "Tabu4"
    End If
    Range("A1").Select
    
    Call progressBar(1)
    
    Call TurnOffCalc 'to run faster
    'I dont want it to create graphs in LP or magazines sheet
    If ActiveSheet.Name = "Knihy_L'uboš" Or ActiveSheet.Name = "Knihy_Žanetka" Then
        Worksheets(ws).Range("$AH$16:$AQ$36").Clear 'prepare area for graphs
        Worksheets(ws).Range("$AH$16:$AQ$36").Delete
        Call histogramVysky 'calling subs
        Call graf
        Range("$AG:$AG").Delete 'I couldnt identify a reason, why a new column is created everytime...
        '...functions are running. Therefore I'm just deleting column
        Columns("$AG:$AG").Insert Shift:=xlToRight, CopyOrigin:=xlFormatFromLeftOrAbove
        Range("$AG:$AG").ClearFormats
        Range("$AG:$AT").Validation.Delete 'clear validation
    End If
    Call progressBar(2) 'set progress bar to 2
    
    ActiveSheet.ListObjects(table).Sort. _
        SortFields.Clear                    'sort by title
    ActiveSheet.ListObjects(table).Sort. _
        SortFields.Add key:=Range(table + "[[#All],[Názov]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortTextAsNumbers
    With ActiveSheet.ListObjects(table).Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    Call progressBar(15)
    ActiveSheet.ListObjects(table).Sort. _
        SortFields.Clear                    'sort by author
        
    'magazines doesn't have an author
    If ActiveSheet.Name <> "Èasopisy" Then
        ActiveSheet.ListObjects(table).Sort. _
            SortFields.Add key:=Range(table + "[[#All],[Autor]]"), SortOn:= _
            xlSortOnValues, Order:=xlAscending, DataOption:=xlSortTextAsNumbers
    End If
    With ActiveSheet.ListObjects(table).Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
    Call progressBar(30)
    Call TurnOnCalc
    ActiveSheet.Calculate 'recalculate formulas
    Call progressBar(35)
    Call tlacitko_prvy_zaznam
    Call progressBar(40)
    Call applyStyle
    Call progressBar(99)
    Application.ErrorCheckingOptions.BackgroundChecking = False 'I dont care about warnings like "wrong format"
    Range("A1").Select
    Unload Progress 'hide progression modal
    finTime = Now()    'for checking performance speed
    resultTime = DateDiff("s", StartTime, finTime)
    Application.StatusBar = "Proces prebehol za " & resultTime & " sekúnd." 'show result in sec in Status bar
    Application.OnTime Now + TimeValue("00:00:05"), "clearStatusBar"    'after five seconds, clear status bar
End Sub

Sub clearStatusBar()
    Application.StatusBar = False
End Sub
     STflag = False
        End If
    End If
End Sub

'following code contain functions for setting styles such as colors, lines, bold text etc
Sub Grey()
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
    End With
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorDark1
        .TintAndShade = -0.149998474074526
        .PatternTintAndShade = 0
    End With
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ThemeColor = 2
        .TintAndShade = 0
        .Weight = xlThin
    End With
    Selection.Borders(xlInsideVertical).LineStyle = xlNone
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone
    End Sub
    
    Sub White()
    With Selection
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
    End With
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorDark1
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.149998474074526
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.149998474074526
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.149998474074526
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.149998474074526
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.149998474074526
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.149998474074526
        .Weight = xlThin
    End With
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ThemeColor = 1
        .TintAndShade = -0.149998474074526
        .Weight = xlThin
    End With
    Selection.Borders(xlInsideHorizontal).LineStyle = xlNone

End Sub
